<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <title>Journal Recommender — Weryfikacja tytułu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body { font-family: Arial, sans-serif; margin: 24px; color:#222; }
        h1 { margin-bottom: 8px; }
        .container { max-width: 1100px; margin: auto; }
        .stats { background:#fbfbfb; border:1px solid #e2e2e2; padding:12px; margin-bottom:18px; }
        .grid { display:flex; gap:12px; flex-wrap:wrap; }
        .stat-box { background:white; border:1px solid #e9e9e9; padding:10px 12px; min-width:160px; box-shadow:0 1px 0 rgba(0,0,0,0.02); }
        form { margin-bottom: 18px; }
        input[type="text"] { width: 78%; padding:8px; font-size:15px; }
        input[type="submit"] { padding:8px 14px; font-size:15px; }
        table { width:100%; border-collapse: collapse; margin-top: 12px; }
        th, td { padding:8px; border:1px solid #ddd; text-align:left; }
        th { background:#f2f2f2; }
        .error { color: #b00020; white-space: pre-wrap; }
        .note { color:#555; font-size:0.9em; margin-top:6px; }
        .plot { margin-top: 14px; border:1px solid #eee; padding:8px; background:white; }
        img.plot-image { width:100%; max-width:1000px; height:auto; display:block; margin:auto; }
    </style>
</head>
<body>
<div class="container">
    <h1>Weryfikacja dopasowania artykułu do czasopism</h1>

    {% if stats %}
    <div class="stats">
        <h3>Podstawowe statystyki zbioru</h3>
        {% if stats.error_loading_data %}
            <p class="error">Błąd przy wczytywaniu danych: {{ stats.error_loading_data }}</p>
        {% else %}
            <div class="grid">
                <div class="stat-box"><strong>Artykuły</strong><div>{{ stats.total_articles }}</div></div>
                <div class="stat-box"><strong>Czasopisma (unikalne)</strong><div>{{ stats.unique_journals }}</div></div>
                <div class="stat-box"><strong>Open Access (liczba)</strong><div>{{ stats.open_access_count }}</div></div>
                <div class="stat-box"><strong>Open Access (udział)</strong><div>{{ (stats.open_access_ratio * 100) | round(1) }}%</div></div>
                <div class="stat-box"><strong>Śr. długość tytułu (słowa)</strong><div>{{ stats.avg_title_word_count if stats.avg_title_word_count is not none else 'n/a' }}</div></div>
                <div class="stat-box"><strong>Śr. długość abstraktu (słowa)</strong><div>{{ stats.avg_abstract_word_count if stats.avg_abstract_word_count is not none else 'n/a' }}</div></div>
            </div>

            {% if stats.top_journals %}
            <h4 style="margin-top:10px">Top 10 czasopism wg liczby artykułów</h4>
            <table>
                <thead><tr><th>#</th><th>Czasopismo</th><th>Liczba artykułów</th></tr></thead>
                <tbody>
                {% for j in stats.top_journals %}
                    <tr><td>{{ loop.index }}</td><td>{{ j.journal }}</td><td>{{ j.count }}</td></tr>
                {% endfor %}
                </tbody>
            </table>
            {% endif %}

            {% if stats.top_years %}
            <h4 style="margin-top:10px">Publikacje wg roku (top 10)</h4>
            <table>
                <thead><tr><th>Rok</th><th>Liczba</th></tr></thead>
                <tbody>
                {% for y, c in stats.top_years.items() %}
                    <tr><td>{{ y }}</td><td>{{ c }}</td></tr>
                {% endfor %}
                </tbody>
            </table>
            {% endif %}
        {% endif %}
    </div>
    {% endif %}

    <form method="post">
        <label for="title"><strong>Wpisz tytuł artykułu do weryfikacji</strong></label><br />
        <input type="text" id="title" name="title" value="{{ title }}" placeholder="Wklej tytuł..." required />
        <input type="submit" value="Sprawdź" />
        <div class="note">Uwaga: możesz również podać abstrakt</div>
    </form>

    {% if ranking_error %}
        <div class="error"><strong>Błąd podczas generowania rankingu:</strong><br/>{{ ranking_error }}</div>
    {% endif %}

    {% if ranking %}
    <h2>Top dopasowań dla tytułu:</h2>

    <div class="plot">
        {% if plot_filename %}
            <img class="plot-image" src="{{ url_for('static', filename=plot_filename) }}" alt="Wykres podobieństw" />
        {% endif %}
    </div>

    <table>
        <thead>
            <tr>
                <th>Ranking</th>
                <th>Czasopismo</th>
                <th>Liczba artykułów</th>
                <th>Średni IF</th>
                <th>Podobieństwo (cosine)</th>
            </tr>
        </thead>
        <tbody>
            {% for row in ranking %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ row.journal }}</td>
                <td>{{ row.n_articles }}</td>
                <td>{{ ("%.3f"|format(row.if) ) if row.if is not none else 'n/a' }}</td>
                <td>{{ ("%.4f"|format(row.similarity) ) if row.similarity is not none else 'n/a' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
</body>
</html>